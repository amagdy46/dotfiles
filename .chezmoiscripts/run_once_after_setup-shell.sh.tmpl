#!/bin/bash
# Setup Zsh and Zim framework

set -e

ZIM_HOME="${ZDOTDIR:-${HOME}}/.zim"

# Install Zim framework if not present
if [[ ! -d "$ZIM_HOME" ]]; then
    echo "Installing Zim framework..."
    curl -fsSL https://raw.githubusercontent.com/zimfw/install/master/install.zsh | zsh
fi

# Set zsh as default shell if not already
CURRENT_SHELL=$(basename "$SHELL")
if [[ "$CURRENT_SHELL" != "zsh" ]]; then
    echo "Setting zsh as default shell..."
    ZSH_PATH=$(which zsh)

{{- if .isMacOS }}
    # macOS: Add zsh to allowed shells if needed
    if ! grep -q "$ZSH_PATH" /etc/shells; then
        echo "$ZSH_PATH" | sudo tee -a /etc/shells
    fi
{{- end }}

    chsh -s "$ZSH_PATH"
    echo "Default shell changed to zsh. Please log out and back in."
fi

echo "Shell setup complete"
